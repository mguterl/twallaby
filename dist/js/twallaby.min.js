/*! An HTML/JS/CSS app - v0.0.1 - 2013-06-04 */
this.JST=this.JST||{},this.JST["app/templates/overview.us"]=function(obj){obj||(obj={});var __t,__p="";with(_.escape,obj)__p+='<div id="overview" class="step" data-scale="'+(null==(__t=this.collection.size()/3)?"":__t)+'"></div>';return __p},this.JST["app/templates/tweet.us"]=function(obj){obj||(obj={});var __t,__p="";with(_.escape,obj)__p+='<div class="tweet__avatar">\n  <img src="'+(null==(__t=get("bigger_profile_image_url"))?"":__t)+'" />\n</div>\n<div class="tweet__content">\n  <p class="tweet__author">@'+(null==(__t=get("from_user"))?"":__t)+'</p>\n  <p class="tweet__text">'+(null==(__t=get("text"))?"":__t)+'</p>\n  <p class="tweet__timestamp" title="'+(null==(__t=get("created_at"))?"":__t)+'"></p>\n</div>\n';return __p},function(){window.Twallaby=function(){function e(t){null==t&&(t={}),this.tweetsCollection=new e.TweetsCollection(t.tweets,{twitterParams:t.twitterParams,urlRoot:t.urlRoot,pollInterval:t.pollInterval}),this.stepsView=new e.StepsView({el:t.element,collection:this.tweetsCollection}),this.stepsView.render()}return e.prototype.startPolling=function(){return this.tweetsCollection.startPolling()},e.prototype.fetch=function(){return this.tweetsCollection.fetch()},e}(),Twallaby.Tweet=Backbone.Model.extend({initialize:function(){return null!=this.get("profile_image_url")?this.set("bigger_profile_image_url",this.get("profile_image_url").replace("normal","bigger")):this.set("bigger_profile_image_url",void 0)}}),Twallaby.TweetsCollection=Backbone.Collection.extend({model:Twallaby.Tweet,twitterParams:{page:1,rpp:20,result_type:"recent"},urlRoot:"http://search.twitter.com/search.json",pollInterval:6e4,initialize:function(e,t){return null==t&&(t={}),this.twitterParams=_.extend({},this.twitterParams,t.twitterParams),t.urlRoot&&(this.urlRoot=t.urlRoot),t.pollInterval?this.pollInterval=t.pollInterval:void 0},startPolling:function(e){var t=this;return this.fetch(),this.interval=setInterval(function(){return t.fetch()},e||this.pollInterval)},stopPolling:function(){return clearInterval(this.interval)},url:function(){var e,t,n,r;t=[],r=this.twitterParams;for(e in r)n=r[e],t.push(""+e+"="+n);return t.push("callback=?"),encodeURI(""+this.urlRoot+"?"+t.join("&"))},parse:function(e){return e.results}}),Twallaby.cssHelper={translate:function(e){return"translate3d("+(e.x||0)+"px,"+(e.y||0)+"px,"+(e.z||0)+"px)"},rotate:function(e){return"rotateX("+(e.x||0)+"deg) rotateY("+(e.y||0)+"deg) rotateZ("+(e.z||0)+"deg)"},scale:function(e){return"scale("+(e||1)+")"},perspective:function(e){return"perspective("+e+"px)"}},$.fn.applyStyles=function(e){return this.each(function(){var t,n,r;r=[];for(t in e)n=e[t],r.push(this.style[Modernizr.prefixed(t)]=n);return r})},Twallaby.randomHelper={integerBetween:function(e,t){return null==e&&(e=0),null==t&&(t=0),Math.floor(Math.random()*(t-e+1)+e)}},Twallaby.StepView=Backbone.View.extend({className:"step",defaultStyles:{position:"absolute",transformStyle:"preserve-3d",transition:"all 0.5s ease-in-out"},currentPosition:{x:0,y:0,z:0},currentRotation:{x:0,y:0,z:0},currentScale:1,position:function(e){return this.currentPosition=e,this.stylize(),this},scale:function(e){return this.currentScale=e,this.stylize(),this},rotate:function(e){return this.currentRotation=e,this.stylize(),this},stylize:function(){var e;return e=["translate(-50%, -50%)",Twallaby.cssHelper.translate(this.currentPosition),Twallaby.cssHelper.rotate(this.currentRotation),Twallaby.cssHelper.scale(this.currentScale)].join(" "),this.$el.applyStyles({transform:e})}}),Twallaby.AnnouncementView=Twallaby.StepView.extend({className:"step announcement",render:function(){return this.$el.applyStyles(this.defaultStyles),this.position({x:this.$el.data("x")||0,y:this.$el.data("y")||0,z:this.$el.data("z")||0}),this.rotate({x:this.$el.data("rotate-x")||0,y:this.$el.data("rotate-y")||0,z:this.$el.data("rotate-z")||0}),this.scale(this.$el.data("scale")||0),this}}),Twallaby.StepsView=Backbone.View.extend({id:"impress",template:JST["app/templates/overview.us"],delay:4e3,announcementInterval:5,perspective:1e3,transitionDuration:1e3,events:{click:"go"},paused:!1,stepCount:0,defaultStyles:{position:"absolute",transformOrigin:"top left",transition:"all 1s ease-in-out",transformStyle:"preserve-3d"},initialize:function(){return this.$canvas=this.$el.children(":first"),this.tweetViews=[],this.announcementViews=[],this.listenTo(this.collection,"add",function(e){return this.repositionTweetViews(),this.appendTweet(e),this.applyPerspective()})},render:function(){return this.$canvas.applyStyles(this.defaultStyles),this.$el.applyStyles(this.defaultStyles),this.$el.applyStyles({top:"50%",left:"50%"}),this.applyPerspective(),this.renderAnnouncements(),this.renderTweets(),this},applyPerspective:function(){return this.$el.applyStyles({transform:""+Twallaby.cssHelper.scale(1)})},renderTweets:function(){var e,t,n,r,i;for(r=this.collection.models,i=[],t=0,n=r.length;n>t;t++)e=r[t],i.push(this.appendTweet(e));return i},renderAnnouncements:function(){var e,t,n,r,i,o;for(i=this.$canvas.children(),o=[],n=0,r=i.length;r>n;n++)t=i[n],e=new Twallaby.AnnouncementView({el:t}),e.render(),o.push(this.announcementViews.push(e));return o},appendTweet:function(e){var t;return t=new Twallaby.TweetView({model:e}),this.position(t),this.$canvas.append(t.render().el),this.tweetViews.push(t)},position:function(e){var t,n,r;return n=100*this.collection.size(),r=2*Math.PI/this.collection.size(),t=this.collection.indexOf(e.model),e.position({x:Math.floor(n*Math.cos(t*r)),y:Math.floor(n*Math.sin(t*r)),z:0})},repositionTweetViews:function(){var e,t,n,r,i;for(r=this.tweetViews,i=[],t=0,n=r.length;n>t;t++)e=r[t],i.push(this.position(e));return i},go:function(){return 0===this.stepCount%this.announcementInterval?this.goToAnnouncement():this.goToTweet()},goTo:function(e){var t;return t={x:-e.currentPosition.x,y:-e.currentPosition.y,z:-e.currentPosition.z},this.$canvas.applyStyles({transform:Twallaby.cssHelper.translate(t)}),this.stepCount+=1},goToTweet:function(e){return this.goTo(this.tweetViews[e]||this.tweetViews[this.randomTweetIndex()])},goToAnnouncement:function(e){return this.goTo(this.announcementViews[e]||this.announcementViews[this.randomAnnouncementIndex()])},randomAnnouncementIndex:function(){return Twallaby.randomHelper.integerBetween(0,this.announcementViews.length-1)},randomTweetIndex:function(){return Twallaby.randomHelper.integerBetween(0,this.tweetViews.length-1)}}),Twallaby.TweetView=Twallaby.StepView.extend({className:"step tweet",template:JST["app/templates/tweet.us"],render:function(){return this.$el.html(this.template(this.model)),this.$(".tweet__timestamp").timeago(),this.$el.applyStyles(this.defaultStyles),this}})}.call(this);